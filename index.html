<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a535c">
    <title>Word Analyzer V2 | Reading Assessment</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-backdrop"></div>
        <div class="login-container">
            <div class="login-brand">
                <div class="brand-icon">
                    <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12C8 9.79 9.79 8 12 8H36C38.21 8 40 9.79 40 12V36C40 38.21 38.21 40 36 40H12C9.79 40 8 38.21 8 36V12Z" fill="currentColor" opacity="0.1"/>
                        <path d="M14 16H34M14 24H28M14 32H22" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                        <circle cx="34" cy="32" r="6" fill="#ff6b6b"/>
                        <path d="M32 32L33.5 33.5L36.5 30.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h1 class="brand-title">Word Analyzer</h1>
                <p class="brand-tagline">Reading Assessment Suite</p>
            </div>

            <div class="login-card">
                <div class="login-header">
                    <h2>Welcome Back</h2>
                    <p>Sign in to access your classroom</p>
                </div>

                <button id="google-sign-in-btn" class="btn-google">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>Continue with Google</span>
                </button>

                <div class="login-divider">
                    <span>Morningside Academy</span>
                </div>

                <p class="login-security">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                    </svg>
                    Your data is encrypted and secure
                </p>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="loading-content">
            <div class="loading-book">
                <div class="book-page page-1"></div>
                <div class="book-page page-2"></div>
                <div class="book-page page-3"></div>
            </div>
            <h2>Preparing your workspace...</h2>
            <p id="loading-status">Loading settings</p>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app-container" class="app-container" style="display: none;">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div class="brand-mark">WA</div>
                <div class="brand-text">
                    <span class="brand-name">Word Analyzer</span>
                    <span class="brand-version">v2.0</span>
                </div>
            </div>

            <!-- Book Spine Progress -->
            <nav class="book-progress" id="book-progress">
                <div class="spine-track">
                    <div class="spine-fill" id="spine-fill"></div>
                </div>
                <div class="progress-steps">
                    <button class="progress-step completed" data-step="setup" id="step-setup">
                        <span class="step-marker">
                            <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                        </span>
                        <span class="step-label">Setup</span>
                    </button>
                    <button class="progress-step" data-step="audio" id="step-audio">
                        <span class="step-marker">1</span>
                        <span class="step-label">Record</span>
                    </button>
                    <button class="progress-step" data-step="capture" id="step-capture">
                        <span class="step-marker">2</span>
                        <span class="step-label">Capture</span>
                    </button>
                    <button class="progress-step" data-step="highlight" id="step-highlight">
                        <span class="step-marker">3</span>
                        <span class="step-label">Highlight</span>
                    </button>
                    <button class="progress-step" data-step="results" id="step-results">
                        <span class="step-marker">4</span>
                        <span class="step-label">Results</span>
                    </button>
                </div>
            </nav>

            <!-- Quick Actions -->
            <div class="sidebar-actions">
                <button class="sidebar-btn" id="class-overview-btn" title="Class Overview">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span>Students</span>
                </button>
                <button class="sidebar-btn" id="new-assessment-btn" title="New Assessment">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                    <span>New</span>
                </button>
            </div>

            <!-- User Profile -->
            <div class="sidebar-user" id="user-profile">
                <button class="user-trigger" id="user-menu-btn">
                    <img id="user-photo" class="user-avatar" src="" alt="">
                    <div class="user-info">
                        <span id="user-name" class="user-name">Teacher</span>
                        <span class="user-role">Educator</span>
                    </div>
                    <svg class="dropdown-chevron" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </button>
                <div class="user-dropdown" id="user-dropdown">
                    <button class="dropdown-item" id="api-settings-btn">
                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/></svg>
                        API Settings
                    </button>
                    <button class="dropdown-item danger" id="sign-out-btn">
                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"/></svg>
                        Sign Out
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Header Bar -->
            <header class="content-header">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobile-menu-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="12" x2="21" y2="12"/>
                            <line x1="3" y1="6" x2="21" y2="6"/>
                            <line x1="3" y1="18" x2="21" y2="18"/>
                        </svg>
                    </button>
                    <div class="current-student" id="current-student-display" style="display: none;">
                        <div class="student-badge">
                            <span class="student-initial" id="student-initial">J</span>
                            <span class="student-name" id="current-student-name">Jose Martinez</span>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="word-counter" id="word-counter">
                        <span class="counter-value" id="word-count">0</span>
                        <span class="counter-label">words</span>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-wrapper">
                <!-- Setup Section -->
                <section id="setup-section" class="page-section active">
                    <div class="section-container">
                        <div class="page-header">
                            <span class="page-badge">Getting Started</span>
                            <h1 class="page-title">API Configuration</h1>
                            <p class="page-subtitle">Connect to Google Cloud services for accurate word detection</p>
                        </div>

                        <div class="setup-card">
                            <div class="setup-illustration">
                                <svg viewBox="0 0 200 160" fill="none">
                                    <rect x="20" y="30" width="160" height="100" rx="8" fill="#1a535c" opacity="0.1"/>
                                    <rect x="35" y="50" width="80" height="8" rx="2" fill="#1a535c" opacity="0.3"/>
                                    <rect x="35" y="65" width="60" height="8" rx="2" fill="#1a535c" opacity="0.2"/>
                                    <rect x="35" y="80" width="100" height="8" rx="2" fill="#1a535c" opacity="0.3"/>
                                    <circle cx="150" cy="90" r="25" fill="#ff6b6b" opacity="0.2"/>
                                    <path d="M142 90L148 96L158 84" stroke="#ff6b6b" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>

                            <div class="setup-content">
                                <h3>Quick Setup Guide</h3>
                                <ol class="setup-steps">
                                    <li>
                                        <span class="step-num">1</span>
                                        <div class="step-content">
                                            <strong>Open Google Cloud Console</strong>
                                            <a href="https://console.cloud.google.com/apis/credentials" target="_blank" class="step-link">
                                                console.cloud.google.com
                                                <svg viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"/><path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"/></svg>
                                            </a>
                                        </div>
                                    </li>
                                    <li>
                                        <span class="step-num">2</span>
                                        <div class="step-content">
                                            <strong>Create an API Key</strong>
                                            <span>Under "Credentials" section</span>
                                        </div>
                                    </li>
                                    <li>
                                        <span class="step-num">3</span>
                                        <div class="step-content">
                                            <strong>Enable Required APIs</strong>
                                            <span>Cloud Vision API + Speech-to-Text API</span>
                                        </div>
                                    </li>
                                </ol>

                                <div class="api-input-group">
                                    <label for="api-key">Your API Key</label>
                                    <div class="input-wrapper">
                                        <input type="password" id="api-key" placeholder="Paste your Google Cloud API key">
                                        <button class="input-toggle" id="toggle-key-visibility" type="button">
                                            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/></svg>
                                        </button>
                                    </div>
                                    <button class="btn btn-primary btn-lg" id="save-api-key-btn">
                                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                                        Validate & Save
                                    </button>
                                </div>

                                <div class="setup-info">
                                    <div class="info-item">
                                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                                        <span>Free tier: 1,000 Vision + 60 min Speech/month</span>
                                    </div>
                                    <div class="info-item">
                                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>
                                        <span>Encrypted & synced to your account</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Audio Recording Section -->
                <section id="audio-section" class="page-section">
                    <div class="section-container">
                        <div class="page-header">
                            <span class="page-badge">Step 1</span>
                            <h1 class="page-title">Record Reading</h1>
                            <p class="page-subtitle">Capture the student's oral reading for analysis</p>
                        </div>

                        <!-- Student Selection -->
                        <div class="student-select-card">
                            <div class="select-header">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                <h3>Select Student</h3>
                            </div>
                            <div class="select-body">
                                <select id="assessment-student-select" class="student-dropdown">
                                    <option value="">Choose a student...</option>
                                </select>
                                <button class="btn btn-outline" id="quick-add-student-btn">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/></svg>
                                    Add New
                                </button>
                            </div>
                            <p class="select-hint">You can also skip and select later</p>
                        </div>

                        <!-- Recording Interface -->
                        <div class="recording-card">
                            <div class="recording-visual" id="recording-visual">
                                <div class="wave-container">
                                    <div class="wave wave-1"></div>
                                    <div class="wave wave-2"></div>
                                    <div class="wave wave-3"></div>
                                </div>
                                <button class="record-btn" id="record-audio-btn">
                                    <svg class="mic-icon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                                    </svg>
                                    <span class="record-label">Start Recording</span>
                                </button>
                            </div>

                            <!-- Recording Active State -->
                            <div class="recording-active" id="recording-active" style="display: none;">
                                <div class="recording-timer">
                                    <span class="timer-display" id="recording-timer">00:00</span>
                                    <div class="timer-progress">
                                        <div class="timer-bar" id="timer-bar"></div>
                                    </div>
                                </div>
                                <button class="stop-btn" id="stop-recording-btn">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <rect x="6" y="6" width="12" height="12" rx="2"/>
                                    </svg>
                                    Stop Recording
                                </button>
                            </div>

                            <!-- Audio Playback -->
                            <div class="audio-playback" id="audio-playback" style="display: none;">
                                <div class="playback-header">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>
                                    <span>Recording Complete</span>
                                </div>
                                <audio id="audio-player-main" controls></audio>
                                <div class="playback-actions">
                                    <button class="btn btn-ghost" id="rerecord-audio-btn">
                                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/></svg>
                                        Re-record
                                    </button>
                                    <button class="btn btn-ghost" id="download-audio-btn">
                                        <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                                        Download
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation -->
                        <div class="page-nav">
                            <button class="btn btn-ghost" id="skip-audio-btn">
                                Skip Audio
                                <span class="btn-hint">Word count only</span>
                            </button>
                            <button class="btn btn-primary" id="next-to-capture-btn" disabled>
                                Continue to Capture
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Camera/Capture Section -->
                <section id="camera-section" class="page-section">
                    <div class="section-container">
                        <div class="page-header">
                            <span class="page-badge">Step 2</span>
                            <h1 class="page-title">Capture Text</h1>
                            <p class="page-subtitle">Photograph the passage that was read aloud</p>
                        </div>

                        <div class="camera-card">
                            <div class="camera-viewport">
                                <video id="camera" autoplay playsinline></video>
                                <canvas id="camera-canvas" style="display: none;"></canvas>
                                <div class="camera-overlay">
                                    <div class="corner corner-tl"></div>
                                    <div class="corner corner-tr"></div>
                                    <div class="corner corner-bl"></div>
                                    <div class="corner corner-br"></div>
                                </div>
                            </div>
                            <div class="camera-controls">
                                <button class="capture-btn" id="capture-btn">
                                    <span class="capture-ring"></span>
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 15.2a3.2 3.2 0 100-6.4 3.2 3.2 0 000 6.4z"/>
                                        <path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
                                    </svg>
                                </button>
                                <button class="btn btn-outline upload-btn" id="upload-btn-camera">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/></svg>
                                    Browse Files
                                </button>
                            </div>
                            <input type="file" id="file-input-camera" accept="image/*" style="display: none;">
                        </div>

                        <div class="tips-card">
                            <h4>Tips for best results</h4>
                            <ul class="tips-list">
                                <li>Ensure good lighting on the text</li>
                                <li>Hold camera steady and parallel to page</li>
                                <li>Include all text that was read</li>
                            </ul>
                        </div>

                        <div class="page-nav">
                            <button class="btn btn-ghost" id="back-to-audio-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
                                Back to Recording
                            </button>
                            <button class="btn btn-primary" id="next-to-highlight-btn" disabled>
                                Continue to Highlight
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Highlight/Selection Section -->
                <section id="image-section" class="page-section">
                    <div class="section-container section-wide">
                        <div class="page-header">
                            <span class="page-badge">Step 3</span>
                            <h1 class="page-title">Highlight Words</h1>
                            <p class="page-subtitle">Select the words that were read aloud</p>
                        </div>

                        <!-- Loading Overlay -->
                        <div id="highlight-loading-overlay" class="analysis-loading" style="display: none;">
                            <div class="loading-spinner"></div>
                            <h3>Analyzing Recording</h3>
                            <p id="highlight-loading-status">Processing audio...</p>
                            <div class="loading-steps">
                                <div class="load-step active" id="load-step-1">
                                    <span class="load-dot"></span>
                                    Transcribing audio
                                </div>
                                <div class="load-step" id="load-step-2">
                                    <span class="load-dot"></span>
                                    Matching words
                                </div>
                                <div class="load-step" id="load-step-3">
                                    <span class="load-dot"></span>
                                    Highlighting text
                                </div>
                            </div>
                        </div>

                        <div class="highlight-toolbar">
                            <div class="toolbar-group">
                                <span class="toolbar-hint">Click words to select/deselect. Drag to select multiple.</span>
                            </div>
                            <div class="toolbar-group">
                                <button class="toolbar-btn" id="zoom-in-btn" title="Zoom In">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M8 6a1 1 0 011 1v1h1a1 1 0 110 2H9v1a1 1 0 11-2 0v-1H6a1 1 0 110-2h1V7a1 1 0 011-1z" clip-rule="evenodd"/></svg>
                                </button>
                                <button class="toolbar-btn" id="zoom-out-btn" title="Zoom Out">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M5 8a1 1 0 011-1h4a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>
                                </button>
                                <button class="toolbar-btn" id="zoom-reset-btn" title="Reset View">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z" clip-rule="evenodd"/></svg>
                                </button>
                                <div class="toolbar-divider"></div>
                                <button class="toolbar-btn" id="reset-selection-btn" title="Clear Selection">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                                    Clear
                                </button>
                                <button class="toolbar-btn" id="redo-autodetect-btn" title="Auto-detect Again">
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/></svg>
                                    Auto-detect
                                </button>
                            </div>
                        </div>

                        <div class="canvas-wrapper">
                            <canvas id="selection-canvas"></canvas>
                        </div>

                        <div id="status" class="status-message"></div>
                        <input type="file" id="file-input-image" accept="image/*" style="display: none;">

                        <div class="page-nav">
                            <button class="btn btn-ghost" id="back-to-capture-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
                                Back to Capture
                            </button>
                            <button class="btn btn-primary btn-lg" id="analyze-audio-btn" disabled>
                                <svg viewBox="0 0 20 20" fill="currentColor"><path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/></svg>
                                Analyze Reading
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Results Section -->
                <section id="results-section" class="page-section">
                    <div class="section-container">
                        <div class="page-header">
                            <span class="page-badge">Complete</span>
                            <h1 class="page-title">Analysis Results</h1>
                            <p class="page-subtitle">Oral Reading Fluency Report</p>
                        </div>

                        <!-- Historical Banner -->
                        <div id="historical-assessment-banner" class="historical-banner" style="display: none;">
                            <div class="banner-content">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/></svg>
                                <div>
                                    <strong>Historical Assessment</strong>
                                    <span><span id="historical-student-name"></span> - <span id="historical-assessment-date"></span></span>
                                </div>
                            </div>
                            <button class="btn btn-outline" id="back-to-profile-btn">Back to Profile</button>
                        </div>

                        <div id="results-container" class="results-grid">
                            <!-- Results dynamically inserted -->
                        </div>

                        <!-- Save Assessment -->
                        <div class="save-card">
                            <h3>Save to Student Profile</h3>
                            <div class="save-controls">
                                <select id="student-select" class="student-dropdown">
                                    <option value="">Choose student...</option>
                                </select>
                                <button class="btn btn-primary" id="save-assessment-btn" disabled>
                                    <svg viewBox="0 0 20 20" fill="currentColor"><path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z"/></svg>
                                    Save Assessment
                                </button>
                            </div>
                            <div id="save-status" class="save-status"></div>
                        </div>

                        <div class="page-nav">
                            <button class="btn btn-ghost" id="back-to-edit-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/></svg>
                                Edit Selection
                            </button>
                            <button class="btn btn-primary" id="start-new-analysis-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/></svg>
                                New Assessment
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Class Overview Section -->
                <section id="class-overview-section" class="page-section">
                    <div class="section-container section-wide">
                        <div class="page-header">
                            <span class="page-badge">Classroom</span>
                            <h1 class="page-title">Class Overview</h1>
                            <p class="page-subtitle">Monitor student progress and performance</p>
                        </div>

                        <div class="class-toolbar">
                            <button class="btn btn-ghost" id="back-from-class-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
                                Back
                            </button>
                            <button class="btn btn-primary" id="add-student-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"/></svg>
                                Add Student
                            </button>
                        </div>

                        <div id="students-grid" class="students-grid">
                            <!-- Student cards dynamically inserted -->
                        </div>
                    </div>
                </section>

                <!-- Student Profile Section -->
                <section id="student-profile-section" class="page-section">
                    <div class="section-container">
                        <div class="profile-header-card">
                            <button class="btn btn-ghost back-btn" id="back-to-class-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/></svg>
                            </button>
                            <div class="profile-avatar" id="profile-avatar">J</div>
                            <div class="profile-info">
                                <h1 id="student-profile-name">Student Name</h1>
                                <p id="student-profile-subtitle">Assessment History</p>
                            </div>
                            <button class="btn btn-danger" id="delete-student-btn">
                                <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                                Delete
                            </button>
                        </div>

                        <div id="student-stats-summary" class="stats-summary">
                            <!-- Stats dynamically inserted -->
                        </div>

                        <div class="progress-chart-container">
                            <h3>Progress Over Time</h3>
                            <canvas id="progress-chart"></canvas>
                        </div>

                        <div id="aggregated-patterns-section">
                            <!-- Pattern analysis dynamically inserted -->
                        </div>

                        <div class="assessment-history-container">
                            <h3>Assessment History</h3>
                            <div id="assessment-history">
                                <!-- Assessment history dynamically inserted -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Audio Recording Modal -->
    <div id="audio-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Recording Settings</h2>
                <button class="modal-close" id="cancel-recording-btn">
                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="audio-duration">Duration</label>
                    <select id="audio-duration" class="form-select">
                        <option value="0.5">30 seconds</option>
                        <option value="1" selected>1 minute</option>
                        <option value="2">2 minutes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="audio-bitrate">Quality</label>
                    <select id="audio-bitrate" class="form-select">
                        <option value="16000">Low (16 kbps)</option>
                        <option value="32000" selected>Standard (32 kbps)</option>
                        <option value="64000">High (64 kbps)</option>
                    </select>
                    <p class="form-hint">Standard quality recommended for best API compatibility</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="start-recording-btn">
                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/></svg>
                    Start Recording
                </button>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="add-student-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Student</h2>
                <button class="modal-close" id="cancel-add-student-btn">
                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="student-name-input">Student Name</label>
                    <input type="text" id="student-name-input" class="form-input" placeholder="e.g., Jose Martinez">
                </div>
                <div class="form-group">
                    <label for="student-grade-input">Grade Level <span class="optional">(optional)</span></label>
                    <input type="text" id="student-grade-input" class="form-input" placeholder="e.g., 3rd Grade">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="confirm-add-student-btn">
                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/></svg>
                    Add Student
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="firebase-auth.js"></script>
    <script type="module" src="firebase-db.js"></script>
    <script type="module" src="firebase-api-key-manager.js"></script>
    <script type="module" src="firebase-wrappers.js"></script>
    <script src="app.js" type="module"></script>
</body>
</html>
